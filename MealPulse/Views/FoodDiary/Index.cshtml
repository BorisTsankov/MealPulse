@model Core.Models.ViewModels.FoodDiaryViewModel

@{
    ViewData["Title"] = "Your Food Diary";
    var selectedDate = (DateTime)ViewBag.SelectedDate;
}

<h2 class="text-center mt-4 mb-3">Your Food Diary</h2>

<div class="d-flex justify-content-between align-items-center mb-4">
    <a class="btn btn-outline-secondary"
       asp-action="Index"
       asp-route-date="@selectedDate.AddDays(-1).ToString("yyyy-MM-dd")">
        ← Previous
    </a>

    <h4 class="mb-0">Diary for @selectedDate.ToString("D")</h4>

    <a class="btn btn-outline-secondary"
       asp-action="Index"
       asp-route-date="@selectedDate.AddDays(1).ToString("yyyy-MM-dd")">
        Next →
    </a>
</div>

@if (ViewBag.TotalCaloriesForDay != null)
{
    <div class="text-end mb-4">
        <span class="badge bg-success fs-5">
            Total Calories: @ViewBag.TotalCaloriesForDay.ToString("N0") kcal
        </span>
    </div>
}

@foreach (var meal in Model.Sections)
{
    <div class="card mb-4 shadow-sm border-primary">
        <div class="card-header bg-primary text-white d-flex justify-content-between align-items-center">
            <strong>@meal.MealName</strong>
            <span class="badge bg-light text-dark">@meal.TotalCalories.ToString("N0") kcal</span>
        </div>

        <div class="card-body">
            @if (meal.Items != null && meal.Items.Any())
            {
                <ul class="list-group mb-3">
                    @foreach (var item in meal.Items)
                    {
                        <li class="list-group-item d-flex justify-content-between align-items-center">
                            <span>@item.FoodName (@item.Quantity @item.Unit)</span>
                            <span class="badge bg-secondary">@item.Calories.ToString("N0") kcal</span>
                        </li>
                    }
                </ul>
            }
            else
            {
                <p class="text-muted fst-italic">No food added yet for @meal.MealName.</p>
            }

            <form asp-action="AddItem"
                  asp-route-date="@selectedDate.ToString("yyyy-MM-dd")"
                  method="post"
                  class="d-flex flex-wrap gap-2 align-items-end"
                  novalidate>
                <input type="hidden" name="MealTypeId" value="@meal.MealTypeId" />
                <input type="hidden" name="date" value="@selectedDate.ToString("yyyy-MM-dd")" />

                <select name="FoodItemId" class="form-select" required>
                    <option value="">-- Select food --</option>
                    @foreach (var food in (List<MealPulse.Models.Models.FoodItem>)ViewBag.FoodItems)
                    {
                        <option value="@food.FoodItemId">@food.Name</option>
                    }
                </select>

                <input type="number" name="Quantity" class="form-control" placeholder="Amount (g/ml)" min="1" required />

                <button type="submit" class="btn btn-primary">Add</button>
            </form>
        </div>
    </div>
}
