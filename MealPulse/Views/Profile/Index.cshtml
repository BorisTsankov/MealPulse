    @model MealPulse.ViewModels.UserProfileViewModel

    @section Styles {
        <link rel="stylesheet" href="~/css/profile.css" />
    }

    @{
        ViewData["Title"] = "Your Profile";
    }

    <div class="profile-page">
        <div class="container mt-5">
            <h1 class="text-center mb-4" style="color: #6f42c1;">Your Profile</h1>

            <div class="profile-card">
                <h4 class="section-header">User Information</h4>
                <dl class="row">
                    <dt class="col-sm-3">First Name</dt>
                    <dd class="col-sm-9">@Model.User.FirstName</dd>

                    <dt class="col-sm-3">Last Name</dt>
                    <dd class="col-sm-9">@Model.User.LastName</dd>

                    <dt class="col-sm-3">Email</dt>
                    <dd class="col-sm-9">@Model.User.email</dd>

                    <dt class="col-sm-3">Birthday</dt>
                    <dd class="col-sm-9">
                        @(Model.User.date_of_birth?.ToString("dd MMM yyyy"))
                    </dd>


                    <dt class="col-sm-3">Gender ID</dt>
                    <dd class="col-sm-9">@Model.User.gender_id</dd>

                    <dt class="col-sm-3">Height (cm)</dt>
                    <dd class="col-sm-9 d-flex align-items-center">
                        @Model.User.height_cm
                        <img src="~/images/edit_image.png" alt="Edit Height" id="editHeightBtn" class="ms-2" style="cursor:pointer; width: 20px; height: 20px;" />
                    </dd>

                    <dt class="col-sm-3">Weight (kg)</dt>
                    <dd class="col-sm-9 d-flex align-items-center">
                        @(Model.Goal?.current_weight_kg.ToString() ?? "Not set")
                        <img src="~/images/edit_image.png" alt="Edit Weight" id="editWeightBtn" class="ms-2" style="cursor:pointer; width: 20px; height: 20px;" />
                    </dd>


                    <dt class="col-sm-3">Activity Level ID</dt>
                    <dd class="col-sm-9">@Model.User.activityLevel_id</dd>

                    <dt class="col-sm-3">Metric ID</dt>
                    <dd class="col-sm-9">@Model.User.metric_id</dd>
                </dl>
            </div>

            <div class="profile-card">
                <h4 class="section-header">Current Goal</h4>

                @if (Model.Goal != null)
                {
                    <dl class="row">
                        <dt class="col-sm-3">Current Weight</dt>
                        <dd class="col-sm-9">@Model.Goal.current_weight_kg</dd>

                        <dt class="col-sm-3">Target Weight</dt>
                        <dd class="col-sm-9">@Model.Goal.target_weight_kg</dd>

                        <dt class="col-sm-3">Start Date</dt>
                        <dd class="col-sm-9">@Model.Goal.start_date.ToShortDateString()</dd>

                        <dt class="col-sm-3">End Date</dt>
                        <dd class="col-sm-9">@Model.Goal.end_date?.ToShortDateString()</dd>

                    <dt class="col-sm-3">Goal Intensity</dt>
                    <dd class="col-sm-9">@Model.GoalIntensityDisplay</dd>
                    @if (Model.Goal.current_weight_kg == Model.Goal.target_weight_kg)
                    {
                        <dd class="col-sm-12 text-warning">
                            Note: Your goal weight matches your current weight, but you've selected @Model.GoalIntensityDisplay as your goal intensity. Caloric needs will be adjusted accordingly.
                        </dd>
                    }

                    </dl>
                }
                else
                {
                    <p><em>You do not have a current goal.</em></p>
                }

                <button id="createGoalBtn" class="btn btn-success mt-3">Create New Goal</button>

            </div>
        </div>
    </div>

    <!-- Modal: Edit Height -->
    <div class="modal fade" id="editHeightModal" tabindex="-1" aria-labelledby="editHeightModalLabel" aria-hidden="true">
        <div class="modal-dialog">
            <div class="modal-content">
                <form asp-action="UpdateHeight" asp-controller="Profile" method="post">
                    <div class="modal-header">
                        <h5 class="modal-title" id="editHeightModalLabel">Update Height</h5>
                        <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                    </div>
                    <div class="modal-body">
                        <input type="hidden" name="user_id" value="@Model.User.user_id" />
                        <div class="form-group">
                            <label for="newHeight">New Height (cm)</label>
                            <input type="number" step="0.1" name="newHeight" class="form-control" required />
                        </div>
                    </div>
                    <div class="modal-footer">
                        <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Cancel</button>
                        <button type="submit" class="btn btn-primary">Update Height</button>
                    </div>
                </form>
            </div>
        </div>
    </div>

    <!-- Modal: Edit Weight -->
    <div class="modal fade" id="editWeightModal" tabindex="-1" aria-labelledby="editWeightModalLabel" aria-hidden="true">
        <div class="modal-dialog">
            <div class="modal-content">
                <form asp-action="UpdateWeight" asp-controller="Profile" method="post">
                    <div class="modal-header">
                        <h5 class="modal-title" id="editWeightModalLabel">Update Weight</h5>
                        <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                    </div>
                    <div class="modal-body">
                        <input type="hidden" name="user_id" value="@Model.User.user_id" />
                        <div class="form-group">
                            <label for="newWeight">New Weight (kg)</label>
                            <input type="number" step="0.1" name="newWeight" class="form-control" required />
                        </div>
                    </div>
                    <div class="modal-footer">
                        <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Cancel</button>
                        <button type="submit" class="btn btn-primary">Update Weight</button>
                    </div>
                </form>
            </div>
        </div>
    </div>

    <!-- Modal: Create New Goal -->
    <div class="modal fade" id="createGoalModal" tabindex="-1" aria-labelledby="createGoalModalLabel" aria-hidden="true">
        <div class="modal-dialog">
            <div class="modal-content">
                <form asp-action="CreateGoal" asp-controller="Profile" method="post">
                    <div class="modal-header">
                        <h5 class="modal-title" id="createGoalModalLabel">Create New Goal</h5>
                        <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                    </div>
                    <div class="modal-body">
                        <input type="hidden" name="user_id" value="@Model.User.user_id" />

                        <!-- Current Weight (pre-filled if exists, editable and required) -->
                        <div class="form-group">
                            <label for="currentWeight">Current Weight (kg)</label>
                            <input type="number" step="0.1" name="currentWeight" class="form-control" value="@Model.Goal?.current_weight_kg" required />
                        </div>

                        <!-- Target Weight -->
                        <div class="form-group">
                            <label for="targetWeight">Target Weight (kg)</label>
                            <input type="number" step="0.1" name="targetWeight" class="form-control" required />
                        </div>

                        <!-- Goal Intensity -->
                        <div class="form-group">
                            <label for="intensity">Goal Intensity</label>
                            <select name="intensity" class="form-control" asp-items="ViewBag.IntensityOptions" required>
                                <option value="">-- Select Intensity --</option>
                            </select>
                        </div>
                    </div>
                    <div class="modal-footer">
                        <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Cancel</button>
                        <button type="submit" class="btn btn-primary">Create Goal</button>
                    </div>
                </form>
            </div>
        </div>
    </div>


    @section Scripts {
        <script>
             document.getElementById("editHeightBtn").addEventListener("click", function () {
                var heightModal = new bootstrap.Modal(document.getElementById('editHeightModal'));
                heightModal.show();
            });

            document.getElementById("editWeightBtn").addEventListener("click", function () {
                var weightModal = new bootstrap.Modal(document.getElementById('editWeightModal'));
                weightModal.show();
            });
        
            // Open the Create Goal Modal
            document.getElementById("createGoalBtn").addEventListener("click", function () {
                var goalModal = new bootstrap.Modal(document.getElementById('createGoalModal'));
                goalModal.show();
            });
        </script>
       
        </script>
    }
